From b0bd4cb8564557573e581edc6adbfa2820ca546d Mon Sep 17 00:00:00 2001
From: Lubomir Rintel <lkundrak@v3.sk>
Date: Tue, 7 Oct 2014 00:12:00 +0200
Subject: [PATCH 1/3] miniprohex: Fix temporary file handling

Avoid insecure temporary file and drop it after use.
---
 miniprohex | 13 +++++--------
 1 file changed, 5 insertions(+), 8 deletions(-)

diff --git a/miniprohex b/miniprohex
index 6f00016..30ff916 100755
--- a/miniprohex
+++ b/miniprohex
@@ -30,10 +30,8 @@ RWOPT=
 FN=
 # Extension provided
 EXT=
-# Options for srec_copy
+# Options for srec_cat
 SRECOPTS=
-# Place to put stuff
-TMPDIR=/tmp
 
 # parse arguments and sort them out
 while [ $# != 0 ]
@@ -97,12 +95,12 @@ PRECVT=
 POSTCVT=
 ;;
 hex)
-RFILE="$TMPDIR/$$.bin"
+RFILE="$(mktemp)"
 PRECVT="srec_cat $FN --intel -o $SRECOPT $RFILE --binary"
 POSTCVT="srec_cat $RFILE --binary $SRECOPTS -o $FN --intel"
 ;;
 srec)
-RFILE=$TMPDIR/$$.bin
+RFILE="$(mktemp)"
 PRECVT="srec_cat $FN --motorola -o $SRECOPT $RFILE --binary"
 POSTCVT="srec_cat $RFILE --binary $SRECOPTS -o $FN --motorola"
 ;;
@@ -129,6 +127,5 @@ minipro $OPTS $RWOPT $RFILE
 $POSTCVT
 fi
 
-
-
-
+# Purge the temporary file if we used one
+[ "$PRECVT" ] && rm "$RFILE"
-- 
2.1.0

